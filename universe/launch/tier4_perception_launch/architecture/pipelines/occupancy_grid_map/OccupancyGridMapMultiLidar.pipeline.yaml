name: OccupancyGridMapMultiLidar.pipeline

depends:
  - PickupBasedVoxelGridDownsampleFilter.module
  - PointcloudBasedOccupancyGridMap.module
  - SynchronizedGridMapFusion.module

nodes:
  - node: obstacle_pc_downsample_filter
    element: PickupBasedVoxelGridDownsampleFilter.module

  - node: raw_pc_downsample_filter_1
    element: PickupBasedVoxelGridDownsampleFilter.module
  - node: raw_pc_downsample_filter_2
    element: PickupBasedVoxelGridDownsampleFilter.module
  - node: raw_pc_downsample_filter_3
    element: PickupBasedVoxelGridDownsampleFilter.module

  - node: occupancy_grid_map_node_1
    element: PointcloudBasedOccupancyGridMap.module
  - node: occupancy_grid_map_node_2
    element: PointcloudBasedOccupancyGridMap.module
  - node: occupancy_grid_map_node_3
    element: PointcloudBasedOccupancyGridMap.module

  - node: occupancy_grid_map_fusion_node
    element: SynchronizedGridMapFusion.module

external_interfaces:
  input:
    # lidar
    - name: obstacle_pointcloud
    - name: pointcloud_1
    - name: pointcloud_2
    - name: pointcloud_3
  output:
    - name: map
  parameter: []

connections:
  - from: input.obstacle_pointcloud
    to: obstacle_pc_downsample_filter.input.input
  
  - from: input.pointcloud_*
    to: raw_pc_downsample_filter_*.input.input

  - from: raw_pc_downsample_filter_*.output.output
    to: occupancy_grid_map_node_*.input.raw_pointcloud

  - from: obstacle_pc_downsample_filter.output.output
    to: occupancy_grid_map_node_1.input.obstacle_pointcloud
  - from: obstacle_pc_downsample_filter.output.output
    to: occupancy_grid_map_node_2.input.obstacle_pointcloud
  - from: obstacle_pc_downsample_filter.output.output
    to: occupancy_grid_map_node_3.input.obstacle_pointcloud

  - from: occupancy_grid_map_node_*.output.occupancy_grid_map
    to: occupancy_grid_map_fusion_node.input.occupancy_grid_map_*

  - from: occupancy_grid_map_fusion_node.output.occupancy_grid_map
    to: output.map
